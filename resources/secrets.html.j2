<!DOCTYPE html>
<html data-theme="dark">
    <head>
        <title>Bruh :: Secrets</title>
        <link rel="stylesheet" href="css/bulma.min.css">
        <link rel="stylesheet" href="css/index.css">
        <script src="js/umbrella.min.js"></script>
        <style>
            .secrets-container {
                max-width: none;
                margin: 0;
            }

            .secrets-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2rem;
                padding-bottom: 1rem;
                border-bottom: 2px solid #333;
            }

            .secrets-title {
                color: #ffffff;
                margin: 0;
                font-size: 1.8rem;
                font-weight: 600;
            }

            .secrets-section {
                margin-bottom: 2rem;
            }

            .secrets-table {
                background-color: #1a1a1a;
                border: 1px solid #333;
                border-radius: 8px;
                overflow: hidden;
            }

            .secrets-table th {
                background-color: #2a2a2a;
                color: #ffffff;
                border-color: #333;
                padding: 1rem;
                font-weight: 600;
            }

            .secrets-table td {
                border-color: #333;
                padding: 1rem;
                vertical-align: middle;
            }

            .secrets-table tbody tr:nth-child(even) {
                background-color: #1e1e1e;
            }

            .secrets-table tbody tr:hover {
                background-color: #252525;
            }

            .secret-value-hidden {
                font-family: 'Courier New', monospace;
                color: #666;
                user-select: none;
            }

            .secret-value-visible {
                font-family: 'Courier New', monospace;
                color: #00d1b2;
                background-color: #1a1a1a;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                border: 1px solid #333;
            }

            .toggle-btn {
                background: none;
                border: none;
                color: #666;
                cursor: pointer;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                transition: all 0.2s ease;
            }

            .toggle-btn:hover {
                background-color: #333;
                color: #ffffff;
            }

            .action-buttons {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }

            .add-secret-form {
                background-color: #1a1a1a;
                border: 1px solid #333;
                border-radius: 8px;
                padding: 2rem;
                margin-bottom: 2rem;
            }

            .form-row {
                display: flex;
                gap: 1rem;
                align-items: end;
            }

            .form-row .field {
                flex: 1;
            }

            .delete-btn {
                background-color: #ff3860;
                border-color: #ff3860;
                color: #ffffff;
            }

            .delete-btn:hover {
                background-color: #cc0f35;
                border-color: #cc0f35;
            }
        </style>
        <script>
            function toggleSecret(name) {
                const valueCell = document.getElementById('secret-value-' + name);
                const toggleBtn = document.getElementById('toggle-btn-' + name);

                if (valueCell.classList.contains('secret-value-hidden')) {
                    // Show the secret
                    fetch('/api/secrets')
                        .then(response => response.json())
                        .then(data => {
                            if (data[name]) {
                                valueCell.textContent = data[name];
                                valueCell.classList.remove('secret-value-hidden');
                                valueCell.classList.add('secret-value-visible');
                                toggleBtn.textContent = 'üôà';
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching secret:', error);
                        });
                } else {
                    // Hide the secret
                    valueCell.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    valueCell.classList.remove('secret-value-visible');
                    valueCell.classList.add('secret-value-hidden');
                    toggleBtn.textContent = 'üëÅÔ∏è';
                }
            }

            function addSecret() {
                const name = document.getElementById('new-secret-name').value.trim();
                const value = document.getElementById('new-secret-value').value.trim();

                if (!name || !value) {
                    alert('Please enter both name and value');
                    return;
                }

                const form = document.getElementById('add-secret-form');
                form.submit();
            }

            function editSecret(name) {
                const currentValue = prompt('Enter new value for secret "' + name + '":');
                if (currentValue !== null && currentValue.trim() !== '') {
                    // Create a form to submit the update
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/secrets';

                    const nameInput = document.createElement('input');
                    nameInput.type = 'hidden';
                    nameInput.name = 'name';
                    nameInput.value = name;
                    form.appendChild(nameInput);

                    const valueInput = document.createElement('input');
                    valueInput.type = 'hidden';
                    valueInput.name = 'value';
                    valueInput.value = currentValue.trim();
                    form.appendChild(valueInput);

                    document.body.appendChild(form);
                    form.submit();
                }
            }

            function deleteSecret(name) {
                if (confirm('Are you sure you want to delete the secret "' + name + '"? This action cannot be undone.')) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/secrets/delete';

                    const nameInput = document.createElement('input');
                    nameInput.type = 'hidden';
                    nameInput.name = 'name';
                    nameInput.value = name;
                    form.appendChild(nameInput);

                    document.body.appendChild(form);
                    form.submit();
                }
            }
        </script>
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <div class="sidebar-brand">
                    <h1>Bruh</h1>
                </div>

                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="{{ protocol }}://{{ host }}/" class="nav-link{% if current_page == 'home' %} active{% endif %}">
                            <i>üè†</i>
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ protocol }}://{{ host }}/sql" class="nav-link{% if current_page == 'sql' %} active{% endif %}">
                            <i>üìä</i>
                            SQL Query
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ protocol }}://{{ host }}/channels" class="nav-link{% if current_page == 'channels' %} active{% endif %}">
                            <i>üì∫</i>
                            Channels
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ protocol }}://{{ host }}/secrets" class="nav-link{% if current_page == 'secrets' %} active{% endif %}">
                            <i>üîê</i>
                            Secrets
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ protocol }}://{{ host }}/docs" class="nav-link{% if current_page == 'docs' %} active{% endif %}">
                            <i>üìö</i>
                            Documentation
                        </a>
                    </li>
                </ul>

                <div class="nav-section">
                    <div class="nav-section-title">Scripts</div>
                    <ul class="nav-menu">
                        {% for script in scripts %}
                        <li class="nav-item">
                            <a href="{{ protocol }}://{{ host }}/edit?script={{ script }}" class="nav-link{% if current_page == 'edit' and script_name == script %} active{% endif %}">
                                <i>üìù</i>
                                {{ script }}
                            </a>
                        </li>
                        {% endfor %}
                        <li class="nav-item">
                            <a href="#" onclick="new_script()" class="nav-link">
                                <i>‚ûï</i>
                                New Script
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Channels</div>
                    <div class="quick-stats">
                        <div class="stat-item">
                            <span class="stat-label">Active</span>
                            <span class="stat-value">{{ channels|length }}</span>
                        </div>
                    </div>
                    {% if channels %}
                    <ul class="nav-menu">
                        {% for channel in channels %}
                        <li class="nav-item">
                            <a href="#" class="nav-link" title="Channel: {{ channel.name }}">
                                <i>üì∫</i>
                                {{ channel.name }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Database</div>
                    <div class="quick-stats">
                        {% set total_rows = namespace(total=0) %}
                        {% for table in sqlite_tables %}
                            {% set total_rows.total = total_rows.total + table.row_count %}
                        {% endfor %}
                        <div class="stat-item">
                            <span class="stat-label">Tables</span>
                            <span class="stat-value">{{ sqlite_tables|length }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Rows</span>
                            <span class="stat-value">{{ total_rows.total }}</span>
                        </div>
                    </div>
                </div>

                <script>
                    function new_script() {
                        let name = prompt("Script name:");
                        if (name != null) {
                            window.location.href = "{{ protocol }}://{{ host }}/new?script=" + name;
                        }
                    }
                </script>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="secrets-container">
                    <div class="secrets-header">
                        <h2 class="secrets-title">üîê Secrets Management</h2>
                        <div class="action-buttons">
                            <button class="button is-info" onclick="document.getElementById('new-secret-name').focus()">
                                <i>‚ûï</i>
                                Add Secret
                            </button>
                        </div>
                    </div>

                    <!-- Add New Secret Form -->
                    <section class="secrets-section">
                        <div class="add-secret-form">
                            <form id="add-secret-form" method="POST" action="/secrets">
                                <div class="form-row">
                                    <div class="field">
                                        <label class="label">Secret Name</label>
                                        <div class="control">
                                            <input class="input" type="text" name="name" id="new-secret-name" placeholder="Enter secret name" required>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label">Secret Value</label>
                                        <div class="control">
                                            <input class="input" type="password" name="value" id="new-secret-value" placeholder="Enter secret value" required>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-primary" type="button" onclick="addSecret()">Add Secret</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </section>

                    <!-- Secrets List -->
                    <section class="secrets-section">
                        <h3 style="color: #ffffff; margin-bottom: 1rem;">Stored Secrets</h3>

                        {% if secret_names %}
                        <div class="table-container">
                            <table class="table secrets-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Value</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for secret_name in secret_names %}
                                    <tr>
                                        <td>
                                            <strong>{{ secret_name }}</strong>
                                        </td>
                                        <td>
                                            <span id="secret-value-{{ secret_name }}" class="secret-value-hidden">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                                        </td>
                                        <td width="250">
                                            <div class="action-buttons">
                                                <button class="toggle-btn" id="toggle-btn-{{ secret_name }}" onclick="toggleSecret('{{ secret_name }}')" title="Toggle visibility">
                                                    üëÅÔ∏è
                                                </button>
                                                <button class="button is-small" onclick="editSecret('{{ secret_name }}')" title="Edit secret">
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button class="button is-danger is-small delete-btn" onclick="deleteSecret('{{ secret_name }}')" title="Delete secret">
                                                    üóëÔ∏è Delete
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="notification is-info">
                            No secrets found. Add your first secret using the form above.
                        </div>
                        {% endif %}
                    </section>
                </div>
            </main>
        </div>
    </body>
</html>
